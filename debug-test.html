<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¸ì œí’€ê¸° ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { display: none; }
        .section.active { display: block; }
        .nav-btn { padding: 10px 20px; margin: 5px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .nav-btn.active { background: #1976D2; }
        .question-content { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .answer-section { margin: 15px 0; }
        button { padding: 8px 16px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .submit-btn { background: #4CAF50; color: white; }
        .next-btn { background: #FF9800; color: white; }
        .hint-btn { background: #9C27B0; color: white; }
        .feedback { margin: 15px 0; padding: 10px; border-radius: 5px; }
        .feedback.correct { background: #d4edda; color: #155724; }
        .feedback.incorrect { background: #f8d7da; color: #721c24; }
        .debug-info { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ë¬¸ì œí’€ê¸° ê¸°ëŠ¥ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>
    
    <nav>
        <button class="nav-btn" data-section="learn">í•™ìŠµí•˜ê¸°</button>
        <button class="nav-btn active" data-section="practice">ë¬¸ì œí’€ê¸°</button>
        <button class="nav-btn" data-section="progress">í•™ìŠµì§„ë„</button>
    </nav>

    <div id="debug-log" class="debug-info">
        <strong>ë””ë²„ê·¸ ë¡œê·¸:</strong><br>
        í˜ì´ì§€ ë¡œë“œë¨...<br>
    </div>

    <!-- í•™ìŠµ ì„¹ì…˜ -->
    <section id="learn" class="section">
        <h2>í•™ìŠµ ë‚´ìš©</h2>
        <p>í•™ìŠµ ì„¹ì…˜ì…ë‹ˆë‹¤.</p>
    </section>

    <!-- ë¬¸ì œ í’€ê¸° ì„¹ì…˜ -->
    <section id="practice" class="section active">
        <h2>ë¬¸ì œ í’€ì–´ë³´ê¸°</h2>
        
        <div class="difficulty-selector">
            <label>ë‚œì´ë„:</label>
            <select id="difficulty">
                <option value="easy">ì‰¬ì›€</option>
                <option value="medium" selected>ë³´í†µ</option>
                <option value="hard">ì–´ë ¤ì›€</option>
            </select>
        </div>
        
        <div id="question-container">
            <div class="question-header">
                <span id="question-number">ë¬¸ì œ 1</span>
                <span id="score">ì ìˆ˜: 0</span>
            </div>
            
            <div id="question-content" class="question-content">
                ë¬¸ì œ ë¡œë”© ì¤‘...
            </div>
            
            <div id="answer-section" class="answer-section">
                <!-- ë‹µë³€ ì…ë ¥ ì˜ì—­ -->
            </div>
            
            <div class="button-group">
                <button id="submit-btn" class="submit-btn" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
                <button id="next-btn" class="next-btn" onclick="loadNextQuestion()" style="display:none;">ë‹¤ìŒ ë¬¸ì œ</button>
                <button id="hint-btn" class="hint-btn" onclick="showSmartHint()">ìŠ¤ë§ˆíŠ¸ íŒíŠ¸</button>
            </div>
            
            <div id="feedback" class="feedback"></div>
        </div>
    </section>

    <!-- í•™ìŠµ ì§„ë„ ì„¹ì…˜ -->
    <section id="progress" class="section">
        <h2>í•™ìŠµ ì§„ë„</h2>
        <p>ì§„ë„ ì„¹ì…˜ì…ë‹ˆë‹¤.</p>
    </section>

    <!-- ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="problems.js"></script>
    <script src="content.js"></script>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentQuestion = null;
        let score = 0;
        let questionCount = 0;
        let correctAnswers = 0;
        
        function debugLog(message) {
            const debugDiv = document.getElementById('debug-log');
            debugDiv.innerHTML += message + '<br>';
            console.log('DEBUG:', message);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        document.addEventListener('DOMContentLoaded', () => {
            debugLog('DOM ë¡œë“œ ì™„ë£Œ');
            
            // ë„¤ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    switchSection(e.target.dataset.section);
                });
            });
            
            // ì´ˆê¸° ë¬¸ì œ ë¡œë“œ ì‹œë„
            debugLog('ì´ˆê¸° ë¬¸ì œ ë¡œë“œ ì‹œë„...');
            setTimeout(() => {
                loadNextQuestion();
            }, 500);
        });
        
        // ì„¹ì…˜ ì „í™˜
        function switchSection(sectionName) {
            debugLog(`ì„¹ì…˜ ì „í™˜: ${sectionName}`);
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            if (sectionName === 'practice') {
                debugLog('ë¬¸ì œí’€ê¸° ì„¹ì…˜ í™œì„±í™” - ë¬¸ì œ ë¡œë“œ ì‹œë„');
                setTimeout(() => {
                    loadNextQuestion();
                }, 100);
            }
        }
        
        // ë¬¸ì œ ë¡œë“œ í•¨ìˆ˜
        function loadNextQuestion() {
            debugLog('loadNextQuestion í˜¸ì¶œë¨');
            
            const questionContent = document.getElementById('question-content');
            const answerSection = document.getElementById('answer-section');
            const questionNumber = document.getElementById('question-number');
            
            if (!questionContent || !answerSection) {
                debugLog('ERROR: DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            debugLog('DOM ìš”ì†Œ í™•ì¸ ì™„ë£Œ');
            
            // generateProblem í•¨ìˆ˜ í™•ì¸
            if (typeof generateProblem !== 'function') {
                debugLog('ERROR: generateProblem í•¨ìˆ˜ê°€ ì—†ìŒ');
                questionContent.innerHTML = 'generateProblem í•¨ìˆ˜ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                return;
            }
            
            debugLog('generateProblem í•¨ìˆ˜ í™•ì¸ ì™„ë£Œ');
            
            questionCount++;
            const difficulty = document.getElementById('difficulty').value;
            
            debugLog(`ë¬¸ì œ ìƒì„± ì‹œë„: ë‚œì´ë„ = ${difficulty}`);
            
            try {
                currentQuestion = generateProblem(difficulty);
                debugLog(`ë¬¸ì œ ìƒì„± ê²°ê³¼: ${currentQuestion ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`);
                
                if (currentQuestion) {
                    debugLog(`ë¬¸ì œ ë‚´ìš©: ${currentQuestion.question ? 'ìˆìŒ' : 'ì—†ìŒ'}`);
                    debugLog(`ë¬¸ì œ íƒ€ì…: ${currentQuestion.type}`);
                }
                
            } catch (error) {
                debugLog(`ERROR: ë¬¸ì œ ìƒì„± ì¤‘ ì˜¤ë¥˜ - ${error.message}`);
                questionContent.innerHTML = `ë¬¸ì œ ìƒì„± ì˜¤ë¥˜: ${error.message}`;
                return;
            }
            
            if (!currentQuestion) {
                debugLog('ERROR: ìƒì„±ëœ ë¬¸ì œê°€ null');
                questionContent.innerHTML = 'ë¬¸ì œë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                return;
            }
            
            if (!currentQuestion.question) {
                debugLog('ERROR: ë¬¸ì œì— question í•„ë“œê°€ ì—†ìŒ');
                questionContent.innerHTML = 'ë¬¸ì œ ë°ì´í„°ê°€ ë¶ˆì™„ì „í•©ë‹ˆë‹¤.';
                return;
            }
            
            // ë¬¸ì œ í‘œì‹œ
            debugLog('ë¬¸ì œ í‘œì‹œ ì‹œì‘');
            questionNumber.textContent = `ë¬¸ì œ ${questionCount}`;
            questionContent.innerHTML = `<h3>${currentQuestion.question}</h3>`;
            
            // ë‹µë³€ ì„¹ì…˜ ìƒì„±
            let answerHTML = '';
            
            if (currentQuestion.type === 'multiple-choice') {
                debugLog(`ê°ê´€ì‹ ë¬¸ì œ - ì„ íƒì§€ ${currentQuestion.options ? currentQuestion.options.length : 0}ê°œ`);
                
                if (currentQuestion.options && currentQuestion.options.length > 0) {
                    answerHTML = '<div class="options">';
                    currentQuestion.options.forEach((option, index) => {
                        answerHTML += `
                            <label class="option">
                                <input type="radio" name="answer" value="${index}">
                                ${option}
                            </label>
                        `;
                    });
                    answerHTML += '</div>';
                } else {
                    debugLog('ERROR: ì„ íƒì§€ê°€ ì—†ìŒ');
                    answerHTML = '<p>ì„ íƒì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                
            } else if (currentQuestion.type === 'short-answer') {
                debugLog('ë‹¨ë‹µí˜• ë¬¸ì œ');
                answerHTML = '<input type="text" id="answer-input" placeholder="ë‹µì„ ì…ë ¥í•˜ì„¸ìš”">';
                
            } else {
                debugLog(`ê¸°íƒ€ ë¬¸ì œ íƒ€ì…: ${currentQuestion.type}`);
                answerHTML = '<input type="text" id="answer-input" placeholder="ë‹µì„ ì…ë ¥í•˜ì„¸ìš”">';
            }
            
            answerSection.innerHTML = answerHTML;
            
            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            document.getElementById('submit-btn').style.display = 'inline-block';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('feedback').innerHTML = '';
            
            debugLog('ë¬¸ì œ í‘œì‹œ ì™„ë£Œ');
        }
        
        // ì •ë‹µ í™•ì¸
        function checkAnswer() {
            debugLog('ì •ë‹µ í™•ì¸ ì‹œì‘');
            
            if (!currentQuestion) {
                debugLog('ERROR: í˜„ì¬ ë¬¸ì œê°€ ì—†ìŒ');
                return;
            }
            
            let userAnswer = '';
            
            if (currentQuestion.type === 'multiple-choice') {
                const selected = document.querySelector('input[name="answer"]:checked');
                if (!selected) {
                    alert('ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                userAnswer = selected.value;
                debugLog(`ì‚¬ìš©ì ë‹µ: ${userAnswer}, ì •ë‹µ: ${currentQuestion.correctIndex}`);
                
            } else {
                const input = document.getElementById('answer-input');
                if (!input) {
                    debugLog('ERROR: ë‹µë³€ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    return;
                }
                userAnswer = input.value.trim();
                debugLog(`ì‚¬ìš©ì ë‹µ: "${userAnswer}"`);
            }
            
            // ì •ë‹µ í™•ì¸
            let isCorrect = false;
            
            if (currentQuestion.type === 'multiple-choice') {
                isCorrect = parseInt(userAnswer) === currentQuestion.correctIndex;
            } else {
                // ë‹¨ë‹µí˜•ì€ í‚¤ì›Œë“œ ë§¤ì¹­ìœ¼ë¡œ í™•ì¸
                if (currentQuestion.keywords) {
                    isCorrect = currentQuestion.keywords.some(keyword => 
                        userAnswer.includes(keyword)
                    );
                } else {
                    isCorrect = userAnswer.toLowerCase() === currentQuestion.answer.toLowerCase();
                }
            }
            
            debugLog(`ì •ë‹µ ì—¬ë¶€: ${isCorrect}`);
            
            // í”¼ë“œë°± í‘œì‹œ
            const feedback = document.getElementById('feedback');
            if (isCorrect) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = 'ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ' + (currentQuestion.explanation || '');
                score += currentQuestion.points || 10;
                correctAnswers++;
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = 'âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. ' + (currentQuestion.explanation || '');
            }
            
            // ì ìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('score').textContent = `ì ìˆ˜: ${score}`;
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
            
            debugLog('ì •ë‹µ í™•ì¸ ì™„ë£Œ');
        }
        
        // íŒíŠ¸ í‘œì‹œ
        function showSmartHint() {
            debugLog('íŒíŠ¸ ìš”ì²­');
            
            if (!currentQuestion || !currentQuestion.hint) {
                alert('ì´ ë¬¸ì œì—ëŠ” íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            alert('ğŸ’¡ íŒíŠ¸: ' + currentQuestion.hint);
        }
    </script>
</body>
</html>